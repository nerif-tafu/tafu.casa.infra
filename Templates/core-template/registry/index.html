<!DOCTYPE html>
<html>
<head>
    <title>Registry Dashboard</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1, h2, h3 { color: #333; }
        .runner-card { border: 1px solid #ddd; border-radius: 4px; padding: 15px; margin-bottom: 15px; background-color: #fff; }
        .service-list { margin-top: 10px; }
        .service-item { background-color: #f8f9fa; padding: 10px; border-radius: 4px; margin-bottom: 5px; }
        .endpoint-list { margin-top: 20px; padding: 10px; background-color: #f0f0f0; border-radius: 4px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        #error { color: red; display: none; }
        #loading { text-align: center; padding: 20px; }
        .refresh-btn { background-color: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Traefik Registry Dashboard</h1>
        
        <div id="loading">Loading data...</div>
        <div id="error">Error loading data</div>
        <div id="dashboard" style="display:none">
            <div>
                <span id="last-updated"></span>
                <button class="refresh-btn" onclick="loadData()">Refresh</button>
            </div>
            
            <h2>Monitored Endpoints</h2>
            <div id="endpoints" class="endpoint-list"></div>
            
            <h2>Discovered Runners</h2>
            <div id="runners"></div>
        </div>
    </div>

    <script>
        function loadData() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            
            fetch('/api/runners')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                    
                    // Last updated
                    document.getElementById('last-updated').textContent = 
                        'Last updated: ' + (data.last_updated || 'Never');
                    
                    // Endpoints
                    const endpointsEl = document.getElementById('endpoints');
                    endpointsEl.innerHTML = '';
                    data.endpoints.forEach(endpoint => {
                        const div = document.createElement('div');
                        div.textContent = endpoint;
                        endpointsEl.appendChild(div);
                    });
                    
                    // Runners
                    const runnersEl = document.getElementById('runners');
                    runnersEl.innerHTML = '';
                    
                    if (data.runners.length === 0) {
                        runnersEl.innerHTML = '<p>No runners discovered yet.</p>';
                        return;
                    }
                    
                    data.runners.forEach(runner => {
                        const card = document.createElement('div');
                        card.className = 'runner-card';
                        
                        card.innerHTML = `
                            <h3>${runner.runner}</h3>
                            <div><strong>Domain:</strong> ${runner.domain}</div>
                            <div><strong>IP:</strong> ${runner.ip}</div>
                            <div class="service-list">
                                <h4>Services</h4>
                                <div id="services-${runner.runner}"></div>
                            </div>
                        `;
                        
                        runnersEl.appendChild(card);
                        
                        const servicesEl = document.getElementById(`services-${runner.runner}`);
                        
                        if (!runner.services || runner.services.length === 0) {
                            servicesEl.innerHTML = '<p>No services found.</p>';
                            return;
                        }
                        
                        runner.services.forEach(service => {
                            const serviceItem = document.createElement('div');
                            serviceItem.className = 'service-item';
                            serviceItem.innerHTML = `
                                <div><strong>${service.name}</strong></div>
                                <div>Full Domain: ${service.fullDomain}</div>
                            `;
                            servicesEl.appendChild(serviceItem);
                        });
                    });
                })
                .catch(error => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('error').style.display = 'block';
                    document.getElementById('error').textContent = 'Error: ' + error.message;
                });
        }
        
        // Load data on page load
        window.onload = loadData;
    </script>
</body>
</html> 